


1 MESECNI PUTNICI
- koliko su putovanja imali po mesecu
- koliko su otkazivanja putovanja imali po mesecu
- vreme i datum otkazivanja voznje
- koliko puta su platili po mesecu 
- koliki je ukupan iznos placanja po mesecu 
- kome su platili 
- kada su platili
- koji su radni dani putnika
- koje je radno vreme 
- adresa polaska bela crkva
- adresa polaska vrsac
- broj telefona
- tip putnika (radnik-ucenik)
- gde su zaposleni ako je radnik
- koja skola je u pitanju za ucenika
(PS NEKI RADE PRIMER NEDELJNI 6-14, NEKI MENJAJU SVAKE NEDELJE RADNO VREME TO BI JA TREBAO RUCNO PRIMER PONEDELJAK 5-13 UTORAK 12-19 SREDA 9-17 i tako dalje)

2 DNEVNI PUTNICI
ovde ne znam sta bi mi trebalo iskreno predlozi mi ti

3 VOZACI
- Koliko dodatih putnika 
- Koliko pokupljenih 
- Koliko otkazanih
- Koliko sitnog novca za kusur
- Koliko imaju pazara (dnevnog/nedeljnog/mesecnog/godisnjeg)
- kilometraza
- Koliko naplacenih mesecnih karata
Sistem za praćenje statistike putnika na relaciji Bela Crkva - Vršac
Razumeo sam da vam je potreban sistem za praćenje statistike putnika i vozača na relaciji Bela Crkva ↔ Vršac. Evo predloga baze podataka u Supabase-u sa tabelama i relacijama:

Struktura baze podataka
1. Tabele
sql
-- Tabela za korisnike (putnici i vozači)
CREATE TABLE users (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    email TEXT UNIQUE,
    phone TEXT NOT NULL,
    full_name TEXT NOT NULL,
    user_type TEXT NOT NULL CHECK (user_type IN ('radnik', 'ucenik', 'dnevni', 'vozac')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabela za mesecne putnike (radnici i ucenici)
CREATE TABLE monthly_passengers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    passenger_type TEXT NOT NULL CHECK (passenger_type IN ('radnik', 'ucenik')),
    workplace TEXT, -- za radnike
    school TEXT, -- za ucenike
    departure_address_bc TEXT NOT NULL, -- adresa polaska iz Bele Crkve
    departure_address_vs TEXT NOT NULL, -- adresa polaska iz Vršca
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabela za radno vreme putnika
CREATE TABLE work_schedules (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    monthly_passenger_id UUID REFERENCES monthly_passengers(id) ON DELETE CASCADE,
    day_of_week INTEGER NOT NULL CHECK (day_of_week BETWEEN 1 AND 7), -- 1=Ponedeljak, 7=Nedelja
    start_time TIME NOT NULL,
    end_time TIME NOT NULL,
    valid_from DATE NOT NULL,
    valid_to DATE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabela za dnevne putnike
CREATE TABLE daily_passengers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    departure_address TEXT,
    destination_address TEXT,
    direction TEXT CHECK (direction IN ('bc_vs', 'vs_bc')), -- Bela Crkva -> Vršac ili obrnuto
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabela za vozače
CREATE TABLE drivers (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID REFERENCES users(id) ON DELETE CASCADE,
    license_number TEXT UNIQUE,
    active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabela za vožnje
CREATE TABLE rides (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    driver_id UUID REFERENCES drivers(id) ON DELETE SET NULL,
    direction TEXT NOT NULL CHECK (direction IN ('bc_vs', 'vs_bc')),
    scheduled_departure TIMESTAMP WITH TIME ZONE NOT NULL,
    actual_departure TIMESTAMP WITH TIME ZONE,
    actual_arrival TIMESTAMP WITH TIME ZONE,
    status TEXT NOT NULL CHECK (status IN ('scheduled', 'in_progress', 'completed', 'cancelled')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabela za putovanja (povezuje putnike sa vožnjama)
CREATE TABLE trips (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    ride_id UUID REFERENCES rides(id) ON DELETE CASCADE,
    passenger_id UUID REFERENCES users(id) ON DELETE CASCADE,
    passenger_type TEXT NOT NULL CHECK (passenger_type IN ('mesecni', 'dnevni')),
    boarding_time TIMESTAMP WITH TIME ZONE,
    dropoff_time TIMESTAMP WITH TIME ZONE,
    status TEXT NOT NULL CHECK (status IN ('scheduled', 'boarded', 'completed', 'cancelled')),
    fare_amount DECIMAL(10,2) DEFAULT 0,
    payment_status TEXT CHECK (payment_status IN ('paid', 'unpaid', 'refunded')),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabela za plaćanja
CREATE TABLE payments (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    trip_id UUID REFERENCES trips(id) ON DELETE SET NULL,
    passenger_id UUID REFERENCES users(id) ON DELETE CASCADE,
    driver_id UUID REFERENCES drivers(id) ON DELETE SET NULL,
    amount DECIMAL(10,2) NOT NULL,
    payment_type TEXT NOT NULL CHECK (payment_type IN ('monthly_pass', 'daily_ticket', 'cash')),
    payment_date TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);

-- Tabela za statistiku vozača
CREATE TABLE driver_statistics (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    driver_id UUID REFERENCES drivers(id) ON DELETE CASCADE,
    ride_id UUID REFERENCES rides(id) ON DELETE SET NULL,
    date DATE NOT NULL,
    additional_passengers INTEGER DEFAULT 0, -- dodatni putnici
    picked_up_passengers INTEGER DEFAULT 0, -- pokupljeni putnici
    cancelled_trips INTEGER DEFAULT 0, -- otkazane vožnje
    small_change_amount DECIMAL(10,2) DEFAULT 0, -- sitan novac za kusur
    daily_revenue DECIMAL(10,2) DEFAULT 0, -- dnevni pazar
    mileage DECIMAL(10,2) DEFAULT 0, -- kilometraža
    monthly_tickets_sold INTEGER DEFAULT 0, -- prodatih mesečnih karata
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW()
);
2. Predloženi podaci za dnevne putnike
Za dnevne putnike možete pratiti:

Broj dnevnih putovanja po danu/smeru

Vreme polaska i dolaska

Naplaćene karte

Frekvenciju putovanja (povremeni/redovni dnevni putnici)

Kontakt informacije (opciono)

Upiti za statistiku
Evo nekih korisnih upita za statistiku:

sql
-- Mesečna statistika za putnike
SELECT 
    mp.passenger_type,
    u.full_name,
    COUNT(t.id) as total_trips,
    SUM(CASE WHEN t.status = 'cancelled' THEN 1 ELSE 0 END) as cancelled_trips,
    COUNT(p.id) as payment_count,
    COALESCE(SUM(p.amount), 0) as total_payment_amount,
    STRING_AGG(DISTINCT ws.day_of_week::text, ', ') as work_days
FROM monthly_passengers mp
JOIN users u ON mp.user_id = u.id
LEFT JOIN trips t ON u.id = t.passenger_id 
    AND t.passenger_type = 'mesecni'
    AND EXTRACT(MONTH FROM t.created_at) = EXTRACT(MONTH FROM CURRENT_DATE)
LEFT JOIN payments p ON t.id = p.trip_id
LEFT JOIN work_schedules ws ON mp.id = ws.monthly_passenger_id 
    AND ws.valid_to IS NULL
GROUP BY mp.id, u.id, mp.passenger_type;

-- Statistika za vozače
SELECT 
    u.full_name,
    ds.date,
    SUM(ds.additional_passengers) as total_additional,
    SUM(ds.picked_up_passengers) as total_picked_up,
    SUM(ds.cancelled_trips) as total_cancelled,
    SUM(ds.small_change_amount) as total_small_change,
    SUM(ds.daily_revenue) as total_revenue,
    SUM(ds.mileage) as total_mileage,
    SUM(ds.monthly_tickets_sold) as total_tickets_sold
FROM drivers d
JOIN users u ON d.user_id = u.id
JOIN driver_statistics ds ON d.id = ds.driver_id
WHERE ds.date BETWEEN '2024-01-01' AND '2024-01-31'
GROUP BY u.full_name, ds.date
ORDER BY ds.date;
Dodatne funkcije
Možete dodati i triggere ili funkcije za automatsko ažuriranje statistike:

sql
-- Funkcija za automatsko ažuriranje statistike vozača
CREATE OR REPLACE FUNCTION update_driver_stats()
RETURNS TRIGGER AS $$
BEGIN
    -- Ažuriranje statistike kada se promeni status vožnje
    IF TG_OP = 'UPDATE' AND OLD.status != NEW.status THEN
        -- Logika za ažuriranje statistike
        INSERT INTO driver_statistics (driver_id, ride_id, date, ...)
        VALUES (NEW.driver_id, NEW.id, CURRENT_DATE, ...);
    END IF;
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER ride_status_change
    AFTER UPDATE ON rides
    FOR EACH ROW
    EXECUTE FUNCTION update_driver_stats();
Ova struktura bi trebala da pokrivi sve vaše zahteve za praćenje statistike. Da li želite da prilagodim neki deo specifičnije vašim potrebama?

POKAZI KAO TABELE
TABELE ZA SUPABASE - STATISTIKA PREVOZA
1. TABELA users (KORISNICI)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID korisnika
email	TEXT UNIQUE	Email adresa
phone	TEXT NOT NULL	Broj telefona
full_name	TEXT NOT NULL	Ime i prezime
user_type	TEXT NOT NULL	Tip: 'radnik', 'ucenik', 'dnevni', 'vozac'
created_at	TIMESTAMP	Datum kreiranja
updated_at	TIMESTAMP	Datum ažuriranja
2. TABELA monthly_passengers (MESEČNI PUTNICI)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID
user_id	UUID (FOREIGN KEY)	Veza ka users tabeli
passenger_type	TEXT NOT NULL	'radnik' ili 'ucenik'
workplace	TEXT	Mesto zaposlenja (za radnike)
school	TEXT	Škola (za učenike)
departure_address_bc	TEXT NOT NULL	Adresa polaska iz Bele Crkve
departure_address_vs	TEXT NOT NULL	Adresa polaska iz Vršca
active	BOOLEAN	Da li je aktivan
created_at	TIMESTAMP	Datum kreiranja
3. TABELA work_schedules (RADNO VREME)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID
monthly_passenger_id	UUID (FOREIGN KEY)	Veza ka monthly_passengers
day_of_week	INTEGER (1-7)	Dan u nedelji (1=Ponedeljak)
start_time	TIME NOT NULL	Početak radnog vremena
end_time	TIME NOT NULL	Kraj radnog vremena
valid_from	DATE NOT NULL	Važi od datuma
valid_to	DATE	Važi do datuma (NULL = trajno)
created_at	TIMESTAMP	Datum kreiranja
4. TABELA daily_passengers (DNEVNI PUTNICI)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID
user_id	UUID (FOREIGN KEY)	Veza ka users tabeli
departure_address	TEXT	Adresa polaska
destination_address	TEXT	Adresa dolaska
direction	TEXT	'bc_vs' ili 'vs_bc'
created_at	TIMESTAMP	Datum kreiranja
5. TABELA drivers (VOZAČI)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID
user_id	UUID (FOREIGN KEY)	Veza ka users tabeli
license_number	TEXT UNIQUE	Broj vozačke dozvole
active	BOOLEAN	Da li je aktivan
created_at	TIMESTAMP	Datum kreiranja
6. TABELA rides (VOŽNJE)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID
driver_id	UUID (FOREIGN KEY)	Veza ka drivers tabeli
direction	TEXT NOT NULL	'bc_vs' ili 'vs_bc'
scheduled_departure	TIMESTAMP	Planirano vreme polaska
actual_departure	TIMESTAMP	Stvarno vreme polaska
actual_arrival	TIMESTAMP	Stvarno vreme dolaska
status	TEXT NOT NULL	'scheduled', 'in_progress', 'completed', 'cancelled'
created_at	TIMESTAMP	Datum kreiranja
7. TABELA trips (PUTOVANJA)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID
ride_id	UUID (FOREIGN KEY)	Veza ka rides tabeli
passenger_id	UUID (FOREIGN KEY)	Veza ka users tabeli
passenger_type	TEXT NOT NULL	'mesecni' ili 'dnevni'
boarding_time	TIMESTAMP	Vreme ukrcavanja
dropoff_time	TIMESTAMP	Vreme iskrcavanja
status	TEXT NOT NULL	'scheduled', 'boarded', 'completed', 'cancelled'
fare_amount	DECIMAL(10,2)	Iznos karte
payment_status	TEXT	'paid', 'unpaid', 'refunded'
created_at	TIMESTAMP	Datum kreiranja
8. TABELA payments (PLAĆANJA)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID
trip_id	UUID (FOREIGN KEY)	Veza ka trips tabeli
passenger_id	UUID (FOREIGN KEY)	Veza ka users tabeli
driver_id	UUID (FOREIGN KEY)	Veza ka drivers tabeli
amount	DECIMAL(10,2) NOT NULL	Iznos plaćanja
payment_type	TEXT NOT NULL	'monthly_pass', 'daily_ticket', 'cash'
payment_date	TIMESTAMP	Datum plaćanja
created_at	TIMESTAMP	Datum kreiranja
9. TABELA driver_statistics (STATISTIKA VOZAČA)
Kolona	Tip	Opis
id	UUID (PRIMARY KEY)	Jedinstveni ID
driver_id	UUID (FOREIGN KEY)	Veza ka drivers tabeli
ride_id	UUID (FOREIGN KEY)	Veza ka rides tabeli
date	DATE NOT NULL	Datum statistike
additional_passengers	INTEGER	Dodatni putnici
picked_up_passengers	INTEGER	Pokupljeni putnici
cancelled_trips	INTEGER	Otkazane vožnje
small_change_amount	DECIMAL(10,2)	Sitan novac za kusur
daily_revenue	DECIMAL(10,2)	Dnevni pazar
mileage	DECIMAL(10,2)	Kilometraža
monthly_tickets_sold	INTEGER	Prodatih mesečnih karata
created_at	TIMESTAMP	Datum kreiranja
VEZE IZMEĐU TABELA:
text
users ← monthly_passengers → work_schedules
users ← daily_passengers
users ← drivers → driver_statistics
drivers → rides → trips → payments
PRIMERI PODATAKA:
work_schedules (Fleksibilno radno vreme):
text
| dan | start_time | end_time | valid_from | valid_to |
|-----|------------|----------|------------|----------|
| 1   | 06:00      | 14:00    | 2024-01-01 | NULL     |
| 2   | 12:00      | 19:00    | 2024-01-01 | NULL     |
| 3   | 09:00      | 17:00    | 2024-01-01 | NULL     |
driver_statistics (Dnevna statistika):
text
| datum     | dodatni_putnici | pokupljeni | otkazani | pazar | kilometraza |
|-----------|-----------------|------------|----------|-------|-------------|
| 2024-01-15| 3               | 25         | 2        | 15000 | 245.5       |
Ove tabele će vam omogućiti da pratite sve potrebne statistike za vaš prevoz!

