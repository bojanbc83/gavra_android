create table public.adrese (
  id uuid not null default gen_random_uuid (),
  naziv character varying not null,
  grad character varying null,
  ulica character varying null,
  broj character varying null,
  koordinate jsonb null,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  constraint adrese_pkey primary key (id)
) TABLESPACE pg_default;



create table public.daily_checkins (
  id uuid not null default gen_random_uuid (),
  vozac text not null,
  datum date not null,
  sitan_novac numeric(10, 2) null default 0.0,
  dnevni_pazari numeric(10, 2) null default 0.0,
  ukupno numeric(10, 2) null default 0.0,
  checkin_vreme timestamp with time zone null default now(),
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  constraint daily_checkins_pkey primary key (id),
  constraint daily_checkins_vozac_datum_key unique (vozac, datum)
) TABLESPACE pg_default;

create index IF not exists idx_daily_checkins_vozac on public.daily_checkins using btree (vozac) TABLESPACE pg_default;

create index IF not exists idx_daily_checkins_datum on public.daily_checkins using btree (datum) TABLESPACE pg_default;




create table public.dnevni_putnici (
  id uuid not null default gen_random_uuid (),
  putnik_ime character varying not null,
  telefon character varying null,
  grad character varying not null,
  broj_mesta integer null,
  datum_putovanja date not null,
  vreme_polaska character varying null,
  cena numeric null,
  status character varying null default 'aktivno'::character varying,
  naplatio_vozac_id uuid null,
  pokupio_vozac_id uuid null,
  dodao_vozac_id uuid null,
  otkazao_vozac_id uuid null,
  vozac_id uuid null,
  obrisan boolean null default false,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  ruta_id uuid null,
  vozilo_id uuid null,
  adresa_id uuid null,
  constraint dnevni_putnici_pkey primary key (id),
  constraint dnevni_putnici_dodao_vozac_id_fkey foreign KEY (dodao_vozac_id) references vozaci (id),
  constraint dnevni_putnici_naplatio_vozac_id_fkey foreign KEY (naplatio_vozac_id) references vozaci (id),
  constraint dnevni_putnici_otkazao_vozac_id_fkey foreign KEY (otkazao_vozac_id) references vozaci (id),
  constraint dnevni_putnici_pokupio_vozac_id_fkey foreign KEY (pokupio_vozac_id) references vozaci (id),
  constraint dnevni_putnici_ruta_id_fkey foreign KEY (ruta_id) references rute (id),
  constraint dnevni_putnici_vozac_id_fkey foreign KEY (vozac_id) references vozaci (id),
  constraint dnevni_putnici_adresa_id_fkey foreign KEY (adresa_id) references adrese (id),
  constraint dnevni_putnici_vozilo_id_fkey foreign KEY (vozilo_id) references vozila (id)
) TABLESPACE pg_default;



create table public.gps_lokacije (
  id uuid not null default gen_random_uuid (),
  vozac_id uuid null,
  vozilo_id uuid null,
  latitude numeric not null,
  longitude numeric not null,
  brzina numeric null,
  pravac numeric null,
  tacnost numeric null,
  vreme timestamp with time zone null default now(),
  constraint gps_lokacije_pkey primary key (id),
  constraint gps_lokacije_vozac_id_fkey foreign KEY (vozac_id) references vozaci (id),
  constraint gps_lokacije_vozilo_id_fkey foreign KEY (vozilo_id) references vozila (id)
) TABLESPACE pg_default;



create table public.mesecni_putnici (
  id uuid not null default gen_random_uuid (),
  putnik_ime character varying not null,
  tip character varying not null,
  tip_skole character varying null,
  broj_telefona character varying null,
  broj_telefona_oca character varying null,
  broj_telefona_majke character varying null,
  polasci_po_danu jsonb not null,
  adresa_bela_crkva text null,
  adresa_vrsac text null,
  tip_prikazivanja character varying null default 'standard'::character varying,
  radni_dani character varying null,
  aktivan boolean null default true,
  status character varying null default 'aktivan'::character varying,
  datum_pocetka_meseca date not null,
  datum_kraja_meseca date not null,
  ukupna_cena_meseca numeric null,
  cena numeric null,
  broj_putovanja integer null default 0,
  broj_otkazivanja integer null default 0,
  poslednje_putovanje timestamp with time zone null,
  vreme_placanja timestamp with time zone null,
  placeni_mesec integer null,
  placena_godina integer null,
  vozac_id uuid null,
  pokupljen boolean null default false,
  vreme_pokupljenja timestamp with time zone null,
  statistics jsonb null default '{}'::jsonb,
  obrisan boolean null default false,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  ruta_id uuid null,
  vozilo_id uuid null,
  adresa_polaska_id uuid null,
  adresa_dolaska_id uuid null,
  ime character varying null,
  prezime character varying null,
  datum_pocetka date null,
  datum_kraja date null,
  constraint mesecni_putnici_pkey primary key (id),
  constraint mesecni_putnici_adresa_dolaska_id_fkey foreign KEY (adresa_dolaska_id) references adrese (id),
  constraint mesecni_putnici_adresa_polaska_id_fkey foreign KEY (adresa_polaska_id) references adrese (id),
  constraint mesecni_putnici_ruta_id_fkey foreign KEY (ruta_id) references rute (id),
  constraint mesecni_putnici_vozac_id_fkey foreign KEY (vozac_id) references vozaci (id),
  constraint mesecni_putnici_vozilo_id_fkey foreign KEY (vozilo_id) references vozila (id)
) TABLESPACE pg_default;

create index IF not exists idx_mesecni_putnici_vozac_id on public.mesecni_putnici using btree (vozac_id) TABLESPACE pg_default;

create index IF not exists idx_mesecni_putnici_aktivan on public.mesecni_putnici using btree (aktivan) TABLESPACE pg_default;

create index IF not exists idx_mesecni_putnici_obrisan on public.mesecni_putnici using btree (obrisan) TABLESPACE pg_default;




create table public.putovanja_istorija (
  id uuid not null default gen_random_uuid (),
  mesecni_putnik_id uuid null,
  datum_putovanja date not null,
  vreme_polaska character varying null,
  status character varying null default 'obavljeno'::character varying,
  vozac_id uuid null,
  napomene text null,
  obrisan boolean null default false,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  ruta_id uuid null,
  vozilo_id uuid null,
  adresa_id uuid null,
  cena numeric null default 0.0,
  tip_putnika character varying null default 'dnevni'::character varying,
  putnik_ime character varying null,
  constraint putovanja_istorija_pkey primary key (id),
  constraint putovanja_istorija_adresa_id_fkey foreign KEY (adresa_id) references adrese (id),
  constraint putovanja_istorija_mesecni_putnik_id_fkey foreign KEY (mesecni_putnik_id) references mesecni_putnici (id),
  constraint putovanja_istorija_ruta_id_fkey foreign KEY (ruta_id) references rute (id),
  constraint putovanja_istorija_vozac_id_fkey foreign KEY (vozac_id) references vozaci (id),
  constraint putovanja_istorija_vozilo_id_fkey foreign KEY (vozilo_id) references vozila (id)
) TABLESPACE pg_default;




create table public.rute (
  id uuid not null default gen_random_uuid (),
  naziv character varying not null,
  opis text null,
  aktivan boolean null default true,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  constraint rute_pkey primary key (id)
) TABLESPACE pg_default;



create table public.vozaci (
  id uuid not null default gen_random_uuid (),
  ime character varying not null,
  email character varying null,
  telefon character varying null,
  aktivan boolean null default true,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  kusur numeric null default 0.0,
  constraint vozaci_pkey primary key (id),
  constraint vozaci_ime_key unique (ime),
  constraint vozaci_kusur_check check ((kusur >= (0)::numeric))
) TABLESPACE pg_default;




create table public.vozila (
  id uuid not null default gen_random_uuid (),
  registarski_broj character varying not null,
  marka character varying null,
  model character varying null,
  godina_proizvodnje integer null,
  broj_mesta integer null,
  aktivan boolean null default true,
  created_at timestamp with time zone null default now(),
  updated_at timestamp with time zone null default now(),
  constraint vozila_pkey primary key (id),
  constraint vozila_registarski_broj_key unique (registarski_broj)
) TABLESPACE pg_default;